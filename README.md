# taxCorrection4Book
インボイス制度対応用の外税の税込総額から個々の書籍の消費税分を適当に割り振るツール

## １．はじめに
消費税法の改正により2023年10月1日から新たなインボイス制度が開始されます。
これにより図書館の図書受入業務においては、外税で書籍の請求書類が届いたときに、請求書類に含まれる個々の書籍に対し消費税額をいかに割り振るか、ということを自ら決める必要がでてきました。
図書館の書籍は少額といえども備品（資産）として扱うことがありますし、ひとつの請求書の中でも別々のでどころの予算が混在しているケースがあり、極力公正に個々の書籍に消費税額を割り振って図書館システムに登録したいところです。
そこでその割り振り作業を、最後の端数の割り振りを除き自動的によりするGoogle Colaboratory用のツールを公開しました。

## ２．消費税率の割り振り法
消費税額を割り振る方法についてさまざま考えられるかと思いますが、このツールでは以下の方法をとっています。
他の割り振り方法のオプションについては、必要があれば対応をしたいと考えて居ます。

### Step1 
１．消費税総額を算出（適格請求書の消費税額と比較し検証） 
請求価格から割引後本体価格総計を差し引いたものが消費税総額となる。 
２．消費税総額を割引後本体価格の価格に比例して割り当てる 
もともとの割引後本体価格に消費税を比率に応じて、小数点以下を切り捨てた上で加算する。 
３．消費税総額分配後の端数を算出する 
上記1-2の計算では小数点以下を切り捨てるので、消費税総額から割り当てできていない端数がでる。 

### Step2 
上記Step１での端数を職員が手作業で金額を割り振る 

## ３．自身のGoogle Colabolatory環境での実行方法
Googleアカウントがあれば、次の方法で実行可能です。

### Google Colaboraryへのコードコピー
次のURLを開き「Open in Colab」ボタンをクリックします
https://github.com/maedaak/taxCorrection4Book/blob/main/taxCorrection4Book.ipynb

### 書籍の一覧の用意
タブ区切りテキストファイルとして処理対象の書籍一覧を用意します。
最低限必要なのは書籍ごとのユニークな番号（1からの連番でも資料な番号でも何でもよい）と、個々の書籍の税抜価格です。
書籍の税抜価格はzeinukiKakakuとして入れてください。
以下にサンプルがあります。
https://github.com/maedaak/taxCorrection4Book/blob/main/test_list.txt

### 請求総額設定
画面左のseikyuSogaku:に、今回処理する請求書に含まれる書籍全体の総額（税込み）を入れます。

### プログラムの実行
プログラムが３つのブロックに分かれており、それぞれの左の欄に再生ボタン（右向きの▲）があります。
これを上から順に実行します。実行中は再生ボタンが回転しますので、それが止まってから次に進んでください。

2つ目の再生ボタンを実行すると「ファイルの選択」ボタンが表示されます。
これをクリックし、あらかじめ用意した書籍の一覧を指定してください。

3つ目の再生ボタンをクリックすると、処理結果がresult.csvとしてPCにダウンロードされます。
これは入力とした書籍の一覧に項目hoseiを追加したもので、このhosei項目に消費税割り振り後の金額が入ります。
また、Google Colaboraryの画面上では「消費税総額」「手作業で補正する端数金額」が表示されるので値を控えてください。

### 手作業での補正
「手作業で補正する端数金額」は、result.csvの処理結果で補正しきれなかった端数です（マイナスになることもあります）。
result.csvに対し、この端数を手作業で割り振ってください。

## ４．ご利用にあたっての注意
簡単な動作検証はしていますが、このプログラムは自己責任にてお使いください。
また、小数点の扱いについては高精度を求めた処理にはしていませんので、よろしくご了解願います。

Maeda Akira


